Let me examine the webhook-related files to create comprehensive documentation.

Now let me also check the webhook trigger utilities:

Now I have all the details needed. Here's the comprehensive **Webhooks documentation**:

---

## `integrations/webhooks.mdx` - Outgoing Webhooks

```mdx
---
title: "Outgoing Webhooks"
description: "Send real-time data to external services when entries are created"
icon: "webhook"
---

Webhooks let you connect your Peanuts helpers to external services like Zapier, Make, n8n, or your own servers. When an entry is created, Peanuts sends a POST request with the entry data to your configured URL.

## What Are Webhooks?

Webhooks are automated HTTP requests that Peanuts sends to your specified URL whenever certain events occur. Think of them as real-time notifications that carry your data to other systems.

    Data is sent immediately when entries are created - no polling required

    Connect to Zapier, Make, n8n, or any webhook-compatible service

    Optional HMAC signatures verify that requests come from Peanuts

    View delivery history with status codes and error messages

## Setting Up a Webhook

    Navigate to your helper and tap the **Settings** (gear) icon, then scroll to **Integrations**.

    Tap the **Outgoing Webhook** accordion to reveal the configuration options.

    Toggle **Enable webhook** to activate webhook delivery for this helper.

    Paste the URL where you want to receive the webhook POST requests.

    Examples:
    - `https://hooks.zapier.com/hooks/catch/123456/abcdef`
    - `https://hook.us1.make.com/abc123xyz`
    - `https://n8n.yourserver.com/webhook/peanuts`
    - `https://api.yourapp.com/webhooks/peanuts`

    Click the **Test** button (flask icon) to send a test payload and verify your endpoint is receiving data correctly.

    Tap **Save** to apply the webhook configuration.

## Webhook Payload Format

Every webhook request is a **POST** request with a JSON body containing event details:

```json
{
  "event": "entry.created",
  "timestamp": "2024-01-15T10:30:00.000Z",
  "helper": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "Expense Tracker",
    "command": "/expense"
  },
  "entry": {
    "id": "7c9e6679-7425-40de-944b-e07fc1f90ae7",
    "data": {
      "amount": 42.50,
      "category": "Food",
      "description": "Lunch meeting",
      "date": "2024-01-15"
    },
    "created_at": "2024-01-15T10:30:00.000Z"
  }
}
```

### Payload Fields

| Field | Type | Description |
|-------|------|-------------|
| `event` | string | Event type: `entry.created`, `entry.updated`, or `entry.deleted` |
| `timestamp` | string | ISO 8601 timestamp when the webhook was sent |
| `helper.id` | string | Unique identifier (UUID) of the helper |
| `helper.name` | string | Display name of the helper |
| `helper.command` | string | Telegram command for the helper |
| `entry.id` | string | Unique identifier (UUID) of the entry |
| `entry.data` | object | All field values from the entry |
| `entry.created_at` | string | When the entry was originally created |

## HTTP Headers

Every webhook request includes these headers:

```http
POST /your-webhook-endpoint HTTP/1.1
Content-Type: application/json
User-Agent: Peanuts-Webhook/1.0
X-Peanuts-Signature: sha256=abc123... (if signing secret is configured)
```

| Header | Description |
|--------|-------------|
| `Content-Type` | Always `application/json` |
| `User-Agent` | Identifies the request as coming from Peanuts |
| `X-Peanuts-Signature` | HMAC-SHA256 signature (only if signing secret is set) |

## Signing Secret (Security)

For production use, we strongly recommend adding a **Signing Secret** to verify that webhook requests genuinely come from Peanuts.

    Create a random string (32+ characters recommended). You can use a password generator or run:
    ```bash
    openssl rand -hex 32
    ```

    Paste the secret in the **Signing Secret** field in your webhook configuration.

    When receiving webhooks, verify the `X-Peanuts-Signature` header matches the expected signature.

### Signature Verification Example

    ```javascript
    const crypto = require('crypto');

    function verifyWebhookSignature(payload, signature, secret) {
      const expectedSignature = 'sha256=' + crypto
        .createHmac('sha256', secret)
        .update(JSON.stringify(payload))
        .digest('hex');

      return crypto.timingSafeEqual(
        Buffer.from(signature),
        Buffer.from(expectedSignature)
      );
    }

    // In your webhook handler:
    app.post('/webhook', (req, res) => {
      const signature = req.headers['x-peanuts-signature'];
      const isValid = verifyWebhookSignature(req.body, signature, YOUR_SECRET);

      if (!isValid) {
        return res.status(401).send('Invalid signature');
      }

      // Process the webhook...
      res.status(200).send('OK');
    });
    ```

    ```python
    import hmac
    import hashlib
    import json

    def verify_webhook_signature(payload, signature, secret):
        expected = 'sha256=' + hmac.new(
            secret.encode(),
            json.dumps(payload).encode(),
            hashlib.sha256
        ).hexdigest()

        return hmac.compare_digest(signature, expected)

    # In your webhook handler:
    @app.route('/webhook', methods=['POST'])
    def handle_webhook():
        signature = request.headers.get('X-Peanuts-Signature')
        is_valid = verify_webhook_signature(
            request.json, 
            signature, 
            YOUR_SECRET
        )

        if not is_valid:
            return 'Invalid signature', 401

        # Process the webhook...
        return 'OK', 200
    ```

    ```php
    function verifyWebhookSignature($payload, $signature, $secret) {
        $expected = 'sha256=' . hash_hmac(
            'sha256', 
            json_encode($payload), 
            $secret
        );

        return hash_equals($signature, $expected);
    }

    // In your webhook handler:
    $signature = $_SERVER['HTTP_X_PEANUTS_SIGNATURE'] ?? '';
    $payload = json_decode(file_get_contents('php://input'), true);

    if (!verifyWebhookSignature($payload, $signature, YOUR_SECRET)) {
        http_response_code(401);
        exit('Invalid signature');
    }

    // Process the webhook...
    http_response_code(200);
    echo 'OK';
    ```

## Delivery History

Peanuts tracks every webhook delivery attempt so you can monitor and troubleshoot issues.

### Delivery Statuses

| Status | Description |
|--------|-------------|
| **Success** | Webhook was delivered and your server responded with 2xx status |
| **Failed** | Delivery failed - check the error message for details |
| **Pending** | Delivery is in progress (rare, usually resolves quickly) |

### Viewing History

The delivery history shows the **last 10 deliveries** for each helper, including:
- HTTP status code from your server
- Error messages (if failed)
- Number of retry attempts
- Relative timestamp ("2 minutes ago")

## Popular Integrations

    1. Create a new Zap and choose **Webhooks by Zapier** as the trigger
    2. Select **Catch Hook** as the trigger event
    3. Copy the webhook URL provided by Zapier
    4. Paste it into your Peanuts webhook configuration
    5. Send a test from Peanuts to set up your Zap fields
    6. Add any actions you want (Google Sheets, Slack, Email, etc.)

    1. Create a new Scenario
    2. Add a **Webhooks** module as the first step
    3. Choose **Custom webhook**
    4. Copy the webhook URL
    5. Paste it into Peanuts and send a test
    6. Make will auto-detect your data structure

    1. Add a **Webhook** node to your workflow
    2. Set the HTTP Method to **POST**
    3. Copy the Production or Test webhook URL
    4. Configure it in Peanuts
    5. Use the **Listen for Test Event** to verify the connection

    1. Open your Google Sheet and go to **Extensions > Apps Script**
    2. Deploy a web app that receives POST requests:
    ```javascript
    function doPost(e) {
      const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
      const data = JSON.parse(e.postData.contents);

      sheet.appendRow([
        data.timestamp,
        data.helper.name,
        JSON.stringify(data.entry.data)
      ]);

      return ContentService.createTextOutput('OK');
    }
    ```
    3. Deploy as web app and use the URL in Peanuts

    1. Create a Slack App at api.slack.com
    2. Enable **Incoming Webhooks**
    3. Create a webhook for your channel
    4. Use a middleware service (Zapier/Make) to transform Peanuts data to Slack format

    Or create a simple proxy server that reformats the payload for Slack's API.

## Best Practices

    Only use HTTPS URLs for webhooks to ensure data is encrypted in transit

    Respond with 200 status code as fast as possible - do heavy processing asynchronously

    Always configure a signing secret for production to prevent spoofed requests

    Use the entry ID to detect and handle potential duplicate deliveries gracefully

## Troubleshooting

    **Common causes:**
    - Your server returned a non-2xx status code
    - The URL is unreachable (firewall, DNS, or server down)
    - Request timed out (server took too long to respond)

    **Solutions:**
    - Check your server logs for errors
    - Verify the URL is accessible from the internet
    - Ensure your server responds within 30 seconds
    - Check if your firewall allows requests from Peanuts

    The test button sends requests directly from your browser. Real webhooks come from Peanuts servers.

    **Check:**
    - Your server accepts POST requests from any origin
    - No IP-based restrictions blocking Peanuts servers
    - The URL is publicly accessible (not localhost)

    **Possible issues:**
    - Secret mismatch between Peanuts and your server
    - Payload is being modified before verification (parsed twice, whitespace changes)
    - Using wrong hashing algorithm (should be HMAC-SHA256)

    **Debug steps:**
    1. Log the raw signature header you receive
    2. Log the signature you compute
    3. Ensure you're using the raw JSON string, not a re-serialized object

    Webhooks only fire when:
    - The webhook is **enabled** in settings
    - A valid **URL** is configured
    - An entry is **created** (updates/deletes not yet supported)

    Check your helper's integration settings to verify the configuration.

## Technical Details

Webhooks are processed asynchronously and do not block entry creation. If a webhook fails, your entry is still saved successfully.

### Request Specifications

| Property | Value |
|----------|-------|
| HTTP Method | POST |
| Content-Type | application/json |
| Timeout | 30 seconds |
| Retry Policy | No automatic retries (currently) |
| Max Payload Size | ~100KB |

### Response Expectations

Your endpoint should:
- Return a **2xx status code** (200, 201, 202, 204) for success
- Respond within **30 seconds**
- Handle the JSON body appropriately

Any non-2xx response is recorded as a failed delivery.

## Credit Usage

Webhooks are included with all plans at no additional credit cost. There are no per-webhook charges.

---

## Related

    Get entries delivered directly to your inbox

    Generate and schedule PDF reports

```

---

## Required Screenshots

The documentation references these placeholder images that need to be created:

| Path | Description |
|------|-------------|
| `/images/integrations/webhook-setup.png` | Webhook configuration interface showing URL field, secret field, and test button |
| `/images/integrations/webhook-history.png` | Delivery history panel showing success/failed deliveries with timestamps |

---

What would you like me to draft next?
- **Email Forwarding** documentation
- **Telegram Integration** documentation  
- **Calendar Export** documentation
- **Fields** documentation (all field types)

Draft Email Forwarding Docs
Draft Telegram Integration Docs
Draft Fields Docs
Draft Calendar Export Docs

